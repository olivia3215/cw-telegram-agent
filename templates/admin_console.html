<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Console</title>
    <link rel="icon" href="/static/favicon.ico" sizes="32x32" />
    <link rel="icon" href="/static/icon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png" />
    <link rel="stylesheet" href="/static/css/admin_console.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
    <div id="auth-overlay" class="auth-overlay hidden" role="dialog" aria-modal="true">
        <div class="auth-card">
            <h2>Verify Access</h2>
            <p>Request a login code sent to the puppet master Telegram account to enable the admin console.</p>
            <div id="auth-error" class="auth-message error hidden" role="alert"></div>
            <div id="auth-status" class="auth-message info hidden"></div>
            <div class="auth-actions">
                <button id="request-code-btn">Send verification code</button>
            </div>
            <div class="auth-code-entry">
                <input id="otp-input" type="text" inputmode="numeric" autocomplete="one-time-code" maxlength="6" placeholder="123456" aria-label="Six digit code">
                <button id="verify-code-btn">Verify</button>
            </div>
        </div>
    </div>
    <div class="header">
        <h1>Admin Console</h1>
    </div>

    <nav class="tab-bar">
        <button class="tab-button active" data-tab="global" title="Global config: media, documents, prompts, parameters, LLMs, costs, new agent.">Global</button>
        <button class="tab-button" data-tab="agents" title="Per-agent config: profile, contacts, parameters, schedule, documents, media, costs.">Agents</button>
        <button class="tab-button" data-tab="conversations" title="View and manage conversations, notes, parameters, XSend, work queue.">Conversations</button>
    </nav>

    <div id="tab-panels">
        <!-- Global Tab -->
        <section class="tab-panel active" data-tab-panel="global">
            <nav class="tab-bar" style="margin-bottom: 16px;">
                <button class="tab-button active" data-subtab="media" title="Browse and edit media.">Media Editor</button>
                <button class="tab-button" data-subtab="documents-global" title="Global documents shared across agents.">Documents</button>
                <button class="tab-button" data-subtab="role-prompts" title="Global role prompts.">Role Prompts</button>
                <button class="tab-button" data-subtab="parameters-global" title="Global parameters.">Parameters</button>
                <button class="tab-button" data-subtab="llms-global" title="Configure LLM models and pricing.">LLMs</button>
                <button class="tab-button" data-subtab="costs-global" title="Global LLM costs.">Costs</button>
                <button class="tab-button" data-subtab="new-agent" title="Create new agent.">New Agent</button>
            </nav>
            <div id="global-container" class="main-container">
                <!-- Media Editor Subtab -->
                <div class="subtab-panel active" data-subtab-panel="media">
                    <div class="controls">
                        <div class="directory-selector">
                            <label for="directory-select">Select Media Directory: <span class="info-icon" data-tooltip="Choose which media directory to browse (e.g. state/media for agent-specific media).">i</span></label><br>
                            <select id="directory-select">
                                <option value="">Choose a directory...</option>
                            </select>
                        </div>

                        <div class="directory-selector" id="media-limit-container" style="display: none; margin-top: 12px;">
                            <label for="media-limit">Limit to most recent media (leave empty for all): <span class="info-icon" data-tooltip="Only for state/media. Show at most this many most recent items; leave empty for all.">i</span></label><br>
                            <input type="number" id="media-limit" min="1" placeholder="e.g., 100" style="width: 200px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>

                        <div class="directory-selector" id="media-search-container" style="display: none; margin-top: 12px;">
                            <label for="media-search">Search media: <span class="info-icon" data-tooltip="Search by media ID, sticker set name, sticker name, or description.">i</span></label><br>
                            <input type="text" id="media-search" placeholder="Search by ID, sticker set, sticker name, or description" style="width: 400px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                            <button onclick="clearMediaSearch()" id="clear-search-btn" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: none; margin-left: 8px;">Clear</button>
                            <div id="search-status" style="margin-top: 4px; font-size: 12px; color: #666;"></div>
                        </div>

                        <div class="directory-selector" id="media-type-container" style="display: none; margin-top: 12px;">
                            <label for="media-type-select">Filter by type: <span class="info-icon" data-tooltip="Filter the list by media type.">i</span></label><br>
                            <select id="media-type-select" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-width: 200px;">
                                <option value="all">All Media</option>
                                <option value="stickers">Stickers</option>
                                <option value="emoji">Emoji Sets</option>
                                <option value="video">Videos</option>
                                <option value="photos">Photos</option>
                                <option value="audio">Audio</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="directory-selector" id="state-media-cleanup-container" style="display: none; margin-top: 12px;">
                            <label for="cleanup-cutoff-days">Cleanup unused state media: <span class="info-icon" data-tooltip="Remove state media files not used in the last N days. Only for state/media.">i</span></label><br>
                            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 6px;">
                                <input type="number" id="cleanup-cutoff-days" min="1" value="7" style="width: 100px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <span style="font-size: 13px; color: #666;">days since last used</span>
                                <button id="cleanup-unused-btn" onclick="cleanupUnusedStateMedia()" style="padding: 8px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;">Delete Unused</button>
                            </div>
                            <div id="cleanup-unused-status" style="margin-top: 6px; font-size: 12px; color: #666;"></div>
                        </div>

                        <div class="import-section">
                            <h3>Import Sticker Set <span class="info-icon" data-tooltip="Import a Telegram sticker set by its short name (e.g. WendyDancer).">i</span></h3>
                            <input type="text" id="sticker-set-name" placeholder="Sticker set name (e.g., WendyDancer)">
                            <button onclick="importStickerSet()">Import Set</button>
                            <div id="import-status"></div>
                        </div>
                    </div>

                    <div class="main-container">
                        <div id="pagination-top" style="display: none; margin-bottom: 16px; padding: 12px; background: white; border-radius: 4px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 12px;">
                                <button onclick="previousPage()" id="prev-btn" title="Go to previous page." style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">← Previous</button>
                                <select id="page-select" title="Jump to a specific page." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-width: 140px;">
                                    <option value="">Go to page…</option>
                                </select>
                                <button onclick="nextPage()" id="next-btn" title="Go to next page." style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Next →</button>
                            </div>
                            <div id="pagination-info" style="font-size: 14px; color: #666;"></div>
                        </div>

                        <div id="media-container">
                            <div class="loading">Select a directory to view media files</div>
                        </div>

                        <div id="pagination-bottom" style="display: none; margin-top: 16px; padding: 12px; background: white; border-radius: 4px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 12px;">
                                <button onclick="previousPage()" id="prev-btn-bottom" title="Go to previous page." style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">← Previous</button>
                                <select id="page-select-bottom" title="Jump to a specific page." style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; min-width: 140px;">
                                    <option value="">Go to page…</option>
                                </select>
                                <button onclick="nextPage()" id="next-btn-bottom" title="Go to next page." style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Next →</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Documents Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="documents-global">
                    <div class="controls">
                        <div class="directory-selector">
                            <label for="global-docs-config-select">Select Config Directory: <span class="info-icon" data-tooltip="Config directory that holds global documents (shared across agents).">i</span></label><br>
                            <select id="global-docs-config-select">
                                <option value="">Choose a config directory...</option>
                            </select>
                        </div>
                        <div class="directory-selector" style="margin-top: 12px;">
                            <label for="global-docs-select">Select Document: <span class="info-icon" data-tooltip="Pick a document to view or edit.">i</span></label><br>
                            <select id="global-docs-select" title="Choose document.">
                                <option value="">Choose a document...</option>
                            </select>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                            <button onclick="createGlobalDoc()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Create New Document</button> <span class="info-icon" data-tooltip="Create a new global document in the selected config directory.">i</span>
                            <button onclick="deleteGlobalDoc()" id="delete-global-doc-btn" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; display: none;">Delete Document</button> <span class="info-icon" data-tooltip="Permanently delete the currently selected document.">i</span>
                        </div>
                    </div>
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="global-docs-editor-container">
                            <div class="loading">Select a config directory and document to edit</div>
                        </div>
                    </div>
                </div>
                
                <!-- Role Prompts Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="role-prompts">
                    <div class="controls">
                        <div class="directory-selector">
                            <label for="global-prompts-config-select">Select Config Directory: <span class="info-icon" data-tooltip="Config directory for global role prompts.">i</span></label><br>
                            <select id="global-prompts-config-select">
                                <option value="">Choose a config directory...</option>
                            </select>
                        </div>
                        <div class="directory-selector" style="margin-top: 12px;">
                            <label for="global-prompts-select">Select Role Prompt: <span class="info-icon" data-tooltip="Pick a role prompt to view or edit.">i</span></label><br>
                            <select id="global-prompts-select">
                                <option value="">Choose a role prompt...</option>
                            </select>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                            <button onclick="createGlobalPrompt()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Create New Role Prompt</button> <span class="info-icon" data-tooltip="Create a new global role prompt in the selected config directory.">i</span>
                            <button onclick="deleteGlobalPrompt()" id="delete-global-prompt-btn" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; display: none;">Delete Role Prompt</button> <span class="info-icon" data-tooltip="Permanently delete the currently selected role prompt.">i</span>
                        </div>
                    </div>
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="global-prompts-editor-container">
                            <div class="loading">Select a config directory and role prompt to edit</div>
                        </div>
                    </div>
                </div>
                
                <!-- Parameters Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="parameters-global">
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="global-parameters-container">
                            <div class="loading">Loading parameters...</div>
                        </div>
                    </div>
                </div>
                
                <!-- LLMs Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="llms-global">
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="global-llms-container">
                            <div class="loading">Loading LLMs...</div>
                        </div>
                    </div>
                </div>

                <!-- Costs Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="costs-global">
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="global-costs-container">
                            <div class="loading">Loading costs...</div>
                        </div>
                    </div>
                </div>

                <!-- New Agent Subtab (Global) -->
                <div class="subtab-panel" data-subtab-panel="new-agent">
                    <div class="main-container" style="margin-top: 16px;">
                        <div style="background: white; padding: 16px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                <button id="new-agent-create-btn" onclick="createNewAgentFromForm()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;" disabled>Create</button> <span class="info-icon" data-tooltip="Create the agent with the current form values. Enable when config directory and name are valid.">i</span>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Config Directory <span class="info-icon" data-tooltip="Config directory where this agent's files will be stored.">i</span></h3>
                                    <select id="new-agent-config-directory" class="agent-param-input" style="min-width: 220px;">
                                        <option value="">Choose a config directory...</option>
                                    </select>
                                    <div style="font-size: 12px; color: #666; margin-top: 4px;">Must be selected</div>
                                </div>
                                <div class="agent-param-section">
                                    <h3>Config Name (filename) <span class="info-icon" data-tooltip="Filename for the agent config (without .md); used in config directory.">i</span></h3>
                                    <input id="new-agent-config-name" type="text" class="agent-param-input" value="Untitled">
                                    <div id="new-agent-config-name-status" style="font-size: 12px; color: #666; margin-top: 4px;"></div>
                                </div>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Agent Name (display) <span class="info-icon" data-tooltip="Display name shown in the admin console and elsewhere.">i</span></h3>
                                    <input id="new-agent-display-name" type="text" class="agent-param-input" value="Untitled Agent">
                                    <div style="font-size: 12px; color: #666; margin-top: 4px;">Must not be empty</div>
                                </div>
                                <div class="agent-param-section">
                                    <h3>Agent Phone <span class="info-icon" data-tooltip="Phone number for the Telegram account (E.164 format).">i</span></h3>
                                    <input id="new-agent-phone" type="text" class="agent-param-input" value="+1234567890">
                                    <div style="font-size: 12px; color: #666; margin-top: 4px;">E.164 format, e.g., +1234567890</div>
                                </div>
                            </div>

                            <div class="agent-param-section">
                                <h3>Agent Instructions <span class="info-icon" data-tooltip="System prompt or instructions for the agent's behavior.">i</span></h3>
                                <textarea id="new-agent-prompt" class="agent-param-input" rows="6" style="resize: vertical;">You are a helpful assistant.</textarea>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Agent LLM (optional) <span class="info-icon" data-tooltip="LLM model for this agent; leave blank to use the global default.">i</span></h3>
                                    <input id="new-agent-llm" type="text" class="agent-param-input" list="new-agent-llm-options" placeholder="Type or select an LLM model...">
                                    <datalist id="new-agent-llm-options"></datalist>
                                </div>
                                <div class="agent-param-section">
                                    <h3>Agent Timezone (optional) <span class="info-icon" data-tooltip="IANA timezone for schedule and time-based behavior.">i</span></h3>
                                    <select id="new-agent-timezone" class="agent-param-input"></select>
                                </div>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Role Prompts <span class="info-icon" data-tooltip="Global role prompts to include in the agent's system prompt.">i</span></h3>
                                    <select id="new-agent-role-prompts" class="agent-param-input" multiple size="6" style="min-width: 200px;"></select>
                                    <div style="font-size: 12px; color: #666; margin-top: 4px;">Select one or more (Ctrl/Cmd+click)</div>
                                </div>
                                <div class="agent-param-section">
                                    <h3>Sticker Sets (optional) (one per line) <span class="info-icon" data-tooltip="Sticker set short names, one per line (e.g. WendyDancer).">i</span></h3>
                                    <textarea id="new-agent-sticker-sets" class="agent-param-input" rows="4" style="resize: vertical;"></textarea>
                                </div>
                            </div>

                            <div class="agent-param-section">
                                <h3>Daily Schedule (optional) <span class="info-icon" data-tooltip="Time-based schedule entries (e.g. when the agent is active).">i</span></h3>
                                <label style="display: inline-flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <input id="new-agent-daily-schedule-enabled" type="checkbox">
                                    Enabled
                                </label>
                                <textarea id="new-agent-daily-schedule" class="agent-param-input" rows="4" style="resize: vertical;" disabled></textarea>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Reset Context On First Message (optional) <span class="info-icon" data-tooltip="If enabled, clear conversation context when the user sends the first message in a new session.">i</span></h3>
                                    <label style="display: inline-flex; align-items: center; gap: 8px;">
                                        <input id="new-agent-reset-context" type="checkbox">
                                        Enabled
                                    </label>
                                </div>
                                <div class="agent-param-section">
                                    <h3>Clear Summaries On First Message (optional) <span class="info-icon" data-tooltip="If enabled, clear stored summaries when the user sends the first message in a new session.">i</span></h3>
                                    <label style="display: inline-flex; align-items: center; gap: 8px;">
                                        <input id="new-agent-clear-summaries" type="checkbox">
                                        Enabled
                                    </label>
                                </div>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Gagged (optional) <span class="info-icon" data-tooltip="If enabled, the agent will not send messages (useful for testing or read-only mode).">i</span></h3>
                                    <label style="display: inline-flex; align-items: center; gap: 8px;">
                                        <input id="new-agent-gagged" type="checkbox">
                                        Enabled
                                    </label>
                                </div>
                            </div>

                            <div class="agent-param-grid">
                                <div class="agent-param-section">
                                    <h3>Start Typing Delay (optional) (seconds) <span class="info-icon" data-tooltip="Seconds before the agent shows typing indicator after receiving a message.">i</span></h3>
                                    <input id="new-agent-start-typing-delay" type="number" class="agent-param-input" min="1" max="3600" step="0.1">
                                </div>
                                <div class="agent-param-section">
                                    <h3>Typing Speed (optional) (chars/sec) <span class="info-icon" data-tooltip="Characters per second when simulating typing.">i</span></h3>
                                    <input id="new-agent-typing-speed" type="number" class="agent-param-input" min="1" max="1000" step="0.1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Agents Tab -->
        <section class="tab-panel" data-tab-panel="agents">
            <nav class="tab-bar" style="margin-bottom: 16px;">
                <button class="tab-button active" data-subtab="profile" title="Profile photo, name, username, bio, birthday.">Profile</button>
                <button class="tab-button" data-subtab="contacts" title="Contact list and partners.">Contacts</button>
                <button class="tab-button" data-subtab="parameters" title="Agent-specific parameters (LLM, typing, etc.).">Parameters</button>
                <button class="tab-button" data-subtab="schedule" title="Daily schedule and activities.">Schedule</button>
                <button class="tab-button" data-subtab="memories" title="Stored memories and summaries.">Memories</button>
                <button class="tab-button" data-subtab="intentions" title="Intent detection and handling.">Intentions</button>
                <button class="tab-button" data-subtab="documents-agent" title="Agent-specific documents.">Documents</button>
                <button class="tab-button" data-subtab="memberships" title="Channel and group memberships.">Memberships</button>
                <button class="tab-button" data-subtab="media" title="Agent media and stickers.">Media</button>
                <button class="tab-button" data-subtab="costs" title="LLM costs for this agent.">Costs</button>
            </nav>
            <div class="controls">
                <div class="directory-selector">
                    <label for="agents-agent-select">Select Agent:</label><br>
                    <select id="agents-agent-select">
                        <option value="">Choose an agent...</option>
                    </select> <span class="info-icon" data-tooltip="Choose which agent to view or edit.">i</span>
                </div>
            </div>
            <div id="agents-container" class="main-container">
                <!-- Profile Subtab -->
                <div class="subtab-panel active" data-subtab-panel="profile">
                    <!-- Agent Profile Section -->
                    <div id="agent-profile-section" style="display: none; margin-bottom: 24px; padding: 20px; background: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px;">
                        <h3 style="margin-top: 0; margin-bottom: 20px; font-size: 18px; color: #2c3e50;">Agent Profile</h3>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: start;">
                            <!-- Profile Photo -->
                            <div style="text-align: center;">
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <button id="agent-profile-photo-prev" onclick="showPreviousAgentProfilePhoto(event)" style="display: none; width: 28px; height: 28px; border-radius: 14px; border: 1px solid #d0d0d0; background: #ffffff; cursor: pointer; font-size: 16px;">&#8249;</button>
                                    <img id="agent-profile-photo" src="" alt="Profile Photo" style="width: 100px; height: 100px; border-radius: 50%; border: 2px solid #e0e0e0; cursor: pointer; object-fit: cover; background: #f5f5f5;" onclick="showProfilePhotoFullscreen()">
                                    <video id="agent-profile-video" src="" style="display: none; width: 100px; height: 100px; border-radius: 50%; border: 2px solid #e0e0e0; cursor: pointer; object-fit: cover; background: #f5f5f5;" autoplay muted loop playsinline onclick="showProfilePhotoFullscreen()"></video>
                                    <button id="agent-profile-photo-next" onclick="showNextAgentProfilePhoto(event)" style="display: none; width: 28px; height: 28px; border-radius: 14px; border: 1px solid #d0d0d0; background: #ffffff; cursor: pointer; font-size: 16px;">&#8250;</button>
                                </div>
                                <div id="agent-profile-photo-index" style="margin-top: 6px; font-size: 12px; color: #666; min-height: 16px;"></div>
                                <div style="margin-top: 2px; font-size: 12px; color: #666;">Click to enlarge</div>
                            </div>
                            <!-- Profile Photo Fullscreen Modal -->
                            <div id="profile-photo-modal" style="display: none; position: fixed; z-index: 2000; inset: 0; background-color: rgba(0,0,0,0.6); cursor: pointer; overflow: auto;" onclick="closeProfilePhotoFullscreen()">
                                <div style="width: min(92vw, 980px); margin: 30px auto; background: #fff; border-radius: 10px; border: 1px solid #ddd; box-shadow: 0 4px 16px rgba(0,0,0,0.2); padding: 14px;" onclick="event.stopPropagation()">
                                    <button id="profile-photo-fullscreen-prev" onclick="showPreviousAgentProfilePhoto(event, true)" style="display: none; position: fixed; left: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8249;</button>
                                    <img id="profile-photo-fullscreen" src="" alt="Profile Photo" style="display: block; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;">
                                    <video id="profile-video-fullscreen" src="" style="display: none; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;" autoplay muted loop playsinline controls></video>
                                    <div style="margin-top: 10px; color: #222;">
                                        <p id="profile-photo-meta-index" style="margin: 0 0 6px 0;"><strong>Item:</strong> 1 of 1</p>
                                        <p id="profile-photo-meta-type" style="margin: 0;"><strong>Type:</strong> image</p>
                                    </div>
                                    <button id="profile-photo-fullscreen-next" onclick="showNextAgentProfilePhoto(event, true)" style="display: none; position: fixed; right: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8250;</button>
                                </div>
                            </div>
                            <!-- Profile Fields -->
                            <div style="display: grid; gap: 16px;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <label for="agent-profile-first-name" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">First Name: <span class="info-icon" data-tooltip="Telegram profile first name.">i</span></label>
                                        <input type="text" id="agent-profile-first-name" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    </div>
                                    <div>
                                        <label for="agent-profile-last-name" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Last Name: <span class="info-icon" data-tooltip="Telegram profile last name.">i</span></label>
                                        <input type="text" id="agent-profile-last-name" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    </div>
                                </div>
                                <div>
<label for="agent-profile-username" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Username: <span class="info-icon" data-tooltip="Telegram @username (without @).">i</span></label>
                                        <input type="text" id="agent-profile-username" placeholder="@username" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
<label for="agent-profile-telegram-id" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Telegram ID: <span class="info-icon" data-tooltip="Numeric Telegram user ID (read-only).">i</span></label>
                                        <input type="text" id="agent-profile-telegram-id" readonly style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;">
                                </div>
                                <div>
<label for="agent-profile-bio" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Bio: <span class="info-icon" data-tooltip="Telegram profile bio (max 70 chars).">i</span></label>
                                        <textarea id="agent-profile-bio" rows="3" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical;" oninput="validateBio()"></textarea>
                                    <div id="agent-profile-bio-status" style="margin-top: 4px; font-size: 12px;"></div>
                                </div>
                                <div>
                                    <label for="agent-profile-birthday" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Birthday: <span class="info-icon" data-tooltip="Profile birthday (month, day, optional year).">i</span></label>
                                    <div style="display: grid; grid-template-columns: auto auto auto; gap: 8px; align-items: center;">
                                        <select id="agent-profile-birthday-month" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                            <option value="">Month</option>
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>
                                        </select>
                                        <select id="agent-profile-birthday-day" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                            <option value="">Day</option>
                                        </select>
                                        <input type="number" id="agent-profile-birthday-year" placeholder="Year (optional)" min="1900" max="2100" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 8px;">
                                    <button onclick="saveAgentProfile()" id="agent-profile-save-btn" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Save Profile</button> <span class="info-icon" data-tooltip="Save profile changes to Telegram.">i</span>
                                    <button onclick="cancelAgentProfileEdit()" id="agent-profile-cancel-btn" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: none;">Cancel</button> <span class="info-icon" data-tooltip="Discard unsaved profile changes.">i</span>
                                    <div id="agent-profile-save-status" style="margin-left: 8px; line-height: 32px; font-size: 14px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="profile-container">
                        <div class="loading">Select an agent to view profile</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="contacts">
                    <div id="agent-contacts-container">
                        <div class="loading">Select an agent to view contacts</div>
                    </div>
                    <div id="contacts-photo-modal" style="display: none; position: fixed; z-index: 2000; inset: 0; background-color: rgba(0,0,0,0.6); cursor: pointer; overflow: auto;" onclick="closeContactPhotoFullscreen()">
                        <div style="width: min(92vw, 980px); margin: 30px auto; background: #fff; border-radius: 10px; border: 1px solid #ddd; box-shadow: 0 4px 16px rgba(0,0,0,0.2); padding: 14px;" onclick="event.stopPropagation()">
                            <button id="contacts-photo-fullscreen-prev" onclick="showPreviousContactPhoto(event)" style="display: none; position: fixed; left: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8249;</button>
                            <img id="contacts-photo-fullscreen" src="" alt="Contact Photo" style="display: block; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;">
                            <video id="contacts-video-fullscreen" src="" style="display: none; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;" autoplay muted loop playsinline controls></video>
                            <div style="margin-top: 10px; color: #222;">
                                <p id="contacts-photo-meta-index" style="margin: 0 0 6px 0;"><strong>Item:</strong> 1 of 1</p>
                                <p id="contacts-photo-meta-type" style="margin: 0;"><strong>Type:</strong> image</p>
                            </div>
                            <button id="contacts-photo-fullscreen-next" onclick="showNextContactPhoto(event)" style="display: none; position: fixed; right: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8250;</button>
                        </div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="parameters">
                    <div id="parameters-container">
                        <div class="loading">Select an agent to configure</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="schedule">
                    <div id="schedule-container">
                        <div class="loading">Select an agent to manage schedule</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="memories">
                    <div id="memories-container">
                        <div class="loading">Select an agent to view memories</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="intentions">
                    <div id="intentions-container">
                        <div class="loading">Select an agent to view intentions</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="documents-agent">
                    <div class="controls">
                        <div class="directory-selector">
                            <label for="agent-docs-select">Select Document: <span class="info-icon" data-tooltip="Pick an agent-specific document to view or edit.">i</span></label><br>
                            <select id="agent-docs-select">
                                <option value="">Choose a document...</option>
                            </select>
                        </div>
                        <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
                            <button onclick="createAgentDoc()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Create New Document</button> <span class="info-icon" data-tooltip="Create a new document for this agent.">i</span>
                            <button onclick="deleteAgentDoc()" id="delete-agent-doc-btn" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; display: none;">Delete Document</button> <span class="info-icon" data-tooltip="Permanently delete the selected document.">i</span>
                        </div>
                    </div>
                    <div class="main-container" style="margin-top: 16px;">
                        <div id="agent-docs-editor-container">
                            <div class="loading">Select an agent and document to edit</div>
                        </div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="memberships">
                    <div id="memberships-container">
                        <div class="loading">Select an agent to manage memberships</div>
                    </div>
                </div>

                <!-- Media Subtab -->
                <div class="subtab-panel" data-subtab-panel="media">
                    <div id="agents-media-container">
                        <div class="media-upload-section" style="margin-bottom: 24px;">
                            <h3>Add Media <span class="info-icon" data-tooltip="Upload files or drag-and-drop to add media for this agent.">i</span></h3>
                            <div class="media-upload-buttons" style="display: flex; gap: 12px; margin-bottom: 16px;">
                                <button id="agents-media-upload-file" class="button">Upload File</button> <span class="info-icon" data-tooltip="Select files to upload.">i</span>
                            </div>
                            <div id="agents-media-drop-zone" class="drop-zone">
                                Drag and drop media files here <span class="info-icon" data-tooltip="Drop files here to upload.">i</span>
                            </div>
                        </div>
                        
                        <div class="media-list-section">
                            <h3>Media Library <span class="info-icon" data-tooltip="Media files (stickers, photos, etc.) available to this agent.">i</span></h3>
                            <div id="agents-media-list" class="media-list">
                                <div class="loading">Select an agent to view media</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subtab-panel" data-subtab-panel="costs">
                    <div id="agent-costs-container">
                        <div class="loading">Select an agent to view costs</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Conversations Tab -->
        <section class="tab-panel" data-tab-panel="conversations">
            <nav class="tab-bar" style="margin-bottom: 16px;">
                <button class="tab-button active" data-subtab="profile-conv" title="Conversation partner profile and info.">Profile</button>
                <button class="tab-button" data-subtab="notes-conv" title="Notes for this conversation.">Notes</button>
                <button class="tab-button" data-subtab="conversation-parameters" title="Parameters for this conversation.">Parameters</button>
                <button class="tab-button" data-subtab="plans" title="Plans and follow-ups.">Plans</button>
                <button class="tab-button" data-subtab="conversation" title="Message thread and actions.">Conversation</button>
                <button class="tab-button" data-subtab="costs-conv" title="LLM costs for this conversation.">Costs</button>
                <button class="tab-button" data-subtab="xsend" title="Send an intent message as the agent.">XSend</button>
                <button class="tab-button" data-subtab="work-queue" title="Work queue for this conversation.">Work Queue</button>
            </nav>
            <div class="controls">
                <div class="directory-selector" style="margin-bottom: 16px;">
                    <label for="recent-conversations-select">Recent Conversations: <span class="info-icon" data-tooltip="Pick a recent conversation to view or manage.">i</span></label><br>
                    <select id="recent-conversations-select">
                        <option value="">Select a recent conversation...</option>
                    </select>
                </div>
                <div class="directory-selector">
                    <label for="conversations-agent-select">Select Agent:</label><br>
                    <select id="conversations-agent-select">
                        <option value="">Choose an agent...</option>
                    </select> <span class="info-icon" data-tooltip="Agent whose conversation to view.">i</span>
                </div>
                <div class="directory-selector" style="margin-top: 16px;">
                    <label for="conversations-partner-select">Select Conversation: <span class="info-icon" data-tooltip="Conversation partner (user or chat).">i</span></label><br>
                    <select id="conversations-partner-select">
                        <option value="">Select Conversation</option>
                    </select>
                    <span style="margin-top: 8px; display: inline-block;">Or type user ID, @username, or phone: <span class="info-icon" data-tooltip="User ID, @username, or phone number to load a conversation (e.g. 123456789, @lambda_n, +1234567890).">i</span></span>
                    <input type="text" id="conversations-user-id" placeholder="e.g., 123456789, @lambda_n, +1234567890" style="margin-top: 4px; display: block; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 300px;">
                    <button onclick="loadConversationData()" style="margin-top: 8px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Load</button> <span class="info-icon" data-tooltip="Load the selected or entered conversation.">i</span>
                </div>
            </div>
            <div id="conversations-container" class="main-container">
                <div class="subtab-panel active" data-subtab-panel="profile-conv">
                    <div id="conversation-profile-section" style="display: none; margin-bottom: 24px; padding: 20px; background: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0; margin-bottom: 12px;">
                            <h3 style="margin: 0; font-size: 18px; color: #2c3e50;">Conversation Profile</h3>
                            <label style="display: flex; align-items: center; gap: 6px; font-weight: 500; color: #2c3e50;">
                                <input type="checkbox" id="conversation-profile-contact-checkbox" onchange="handleConversationContactToggle()">
                                Contact
                            </label>
                        </div>
                        <div id="conversation-profile-deleted" style="display: none; margin-bottom: 12px; color: #dc3545; font-weight: 500;">Deleted account</div>
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: start;">
                            <div style="text-align: center;">
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <button id="conversation-profile-photo-prev" onclick="showPreviousConversationProfilePhoto(event)" style="display: none; width: 28px; height: 28px; border-radius: 14px; border: 1px solid #d0d0d0; background: #ffffff; cursor: pointer; font-size: 16px;">&#8249;</button>
                                    <img id="conversation-profile-photo" src="" alt="Profile Photo" style="width: 100px; height: 100px; border-radius: 50%; border: 2px solid #e0e0e0; cursor: pointer; object-fit: cover; background: #f5f5f5;" onclick="showConversationProfilePhotoFullscreen()">
                                    <video id="conversation-profile-video" src="" style="display: none; width: 100px; height: 100px; border-radius: 50%; border: 2px solid #e0e0e0; cursor: pointer; object-fit: cover; background: #f5f5f5;" autoplay muted loop playsinline onclick="showConversationProfilePhotoFullscreen()"></video>
                                    <button id="conversation-profile-photo-next" onclick="showNextConversationProfilePhoto(event)" style="display: none; width: 28px; height: 28px; border-radius: 14px; border: 1px solid #d0d0d0; background: #ffffff; cursor: pointer; font-size: 16px;">&#8250;</button>
                                </div>
                                <div id="conversation-profile-photo-index" style="margin-top: 6px; font-size: 12px; color: #666; min-height: 16px;"></div>
                                <div style="margin-top: 2px; font-size: 12px; color: #666;">Click to enlarge</div>
                            </div>
                            <div id="conversation-profile-photo-modal" style="display: none; position: fixed; z-index: 2000; inset: 0; background-color: rgba(0,0,0,0.6); cursor: pointer; overflow: auto;" onclick="closeConversationProfilePhotoFullscreen()">
                                <div style="width: min(92vw, 980px); margin: 30px auto; background: #fff; border-radius: 10px; border: 1px solid #ddd; box-shadow: 0 4px 16px rgba(0,0,0,0.2); padding: 14px;" onclick="event.stopPropagation()">
                                    <button id="conversation-profile-photo-fullscreen-prev" onclick="showPreviousConversationProfilePhoto(event, true)" style="display: none; position: fixed; left: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8249;</button>
                                    <img id="conversation-profile-photo-fullscreen" src="" alt="Profile Photo" style="display: block; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;">
                                    <video id="conversation-profile-video-fullscreen" src="" style="display: none; width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; background: #f6f6f6;" autoplay muted loop playsinline controls></video>
                                    <div style="margin-top: 10px; color: #222;">
                                        <p id="conversation-profile-photo-meta-index" style="margin: 0 0 6px 0;"><strong>Item:</strong> 1 of 1</p>
                                        <p id="conversation-profile-photo-meta-type" style="margin: 0;"><strong>Type:</strong> image</p>
                                    </div>
                                    <button id="conversation-profile-photo-fullscreen-next" onclick="showNextConversationProfilePhoto(event, true)" style="display: none; position: fixed; right: 16px; top: 50%; transform: translateY(-50%); border: none; background: rgba(0,0,0,0.45); color: white; width: 44px; height: 44px; border-radius: 22px; cursor: pointer; font-size: 28px; z-index: 2001;">&#8250;</button>
                                </div>
                            </div>
                            <div style="display: grid; gap: 16px;">
                                <div id="conversation-profile-name-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <label id="conversation-profile-first-name-label" for="conversation-profile-first-name" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">First Name:</label>
                                        <input type="text" id="conversation-profile-first-name" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" readonly oninput="conversationProfileFieldChanged()">
                                    </div>
                                    <div id="conversation-profile-last-name-container">
                                        <label for="conversation-profile-last-name" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Last Name:</label>
                                        <input type="text" id="conversation-profile-last-name" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" readonly oninput="conversationProfileFieldChanged()">
                                    </div>
                                </div>
                                <div>
                                    <label for="conversation-profile-username" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Username:</label>
                                    <input type="text" id="conversation-profile-username" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" readonly>
                                </div>
                                <div>
                                    <label for="conversation-profile-telegram-id" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Telegram ID:</label>
                                    <input type="text" id="conversation-profile-telegram-id" readonly style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;">
                                </div>
                                <div id="conversation-profile-member-count-container" style="display: none;">
                                    <label for="conversation-profile-member-count" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Members:</label>
                                    <input type="text" id="conversation-profile-member-count" readonly style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;">
                                </div>
                                <div>
                                    <label id="conversation-profile-bio-label" for="conversation-profile-bio" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Bio:</label>
                                    <textarea id="conversation-profile-bio" rows="3" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical; background: #f5f5f5; color: #666;" readonly></textarea>
                                </div>
                                <div id="conversation-profile-birthday-container">
                                    <label for="conversation-profile-birthday" style="display: block; margin-bottom: 4px; font-weight: 500; color: #2c3e50;">Birthday:</label>
                                    <div style="display: grid; grid-template-columns: auto auto auto; gap: 8px; align-items: center;">
                                        <select id="conversation-profile-birthday-month" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" disabled>
                                            <option value="">Month</option>
                                            <option value="1">January</option>
                                            <option value="2">February</option>
                                            <option value="3">March</option>
                                            <option value="4">April</option>
                                            <option value="5">May</option>
                                            <option value="6">June</option>
                                            <option value="7">July</option>
                                            <option value="8">August</option>
                                            <option value="9">September</option>
                                            <option value="10">October</option>
                                            <option value="11">November</option>
                                            <option value="12">December</option>
                                        </select>
                                        <select id="conversation-profile-birthday-day" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" disabled>
                                            <option value="">Day</option>
                                        </select>
                                        <input type="number" id="conversation-profile-birthday-year" placeholder="Year (optional)" min="1900" max="2100" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background: #f5f5f5; color: #666;" readonly>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 8px;">
                                    <button onclick="saveConversationProfile()" id="conversation-profile-save-btn" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;" disabled>Save Contact</button>
                                    <button onclick="cancelConversationProfileEdit()" id="conversation-profile-cancel-btn" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: none;">Cancel</button>
                                    <div id="conversation-profile-save-status" style="margin-left: 8px; line-height: 32px; font-size: 14px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="conversation-profile-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="notes-conv">
                    <div id="notes-conv-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="conversation-parameters">
                    <div id="conversation-parameters-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="plans">
                    <div id="plans-container">
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="conversation">
                    <div id="conversation-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="costs-conv">
                    <div id="conversation-costs-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="xsend">
                    <div id="xsend-container">
                        <div class="loading">Select an agent and conversation partner</div>
                        <div style="margin-top: 16px; display: none;" id="xsend-content">
                            <div class="directory-selector">
                                <label for="xsend-intent-textarea">Intent: <span class="info-icon" data-tooltip="Message or intent to send as the agent to the conversation partner.">i</span></label><br>
                                <textarea id="xsend-intent-textarea" placeholder="Enter the intent message..." style="width: 100%; min-height: 150px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; resize: vertical; box-sizing: border-box;"></textarea>
                            </div>
                            <div style="margin-top: 16px;">
                                <button onclick="sendXSend()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">XSend</button> <span class="info-icon" data-tooltip="Send the intent message as the agent.">i</span>
                                <div id="xsend-status" style="margin-top: 8px; font-size: 14px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="subtab-panel" data-subtab-panel="work-queue">
                    <div id="work-queue-container">
                        <div class="loading">Select an agent and conversation partner</div>
                    </div>
                </div>
            </div>
        </section>


    </div>
    <script src="/static/js/admin_console_core.js"></script>
    <script src="/static/js/admin_console_global.js"></script>
    <script src="/static/js/media_preview_shared.js"></script>
    <script src="/static/js/admin_console_media.js"></script>
    <script src="/static/js/admin_console_agents.js"></script>
    <script src="/static/js/admin_console_conversations.js"></script>
</body>
</html>
